<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>月齢</title>
</head>

<body>
    <h1 id="geturei">月齢：</h1>
    <script>
        function calcGeturei() {
            var element = document.getElementById("geturei");

            const date = new Date(Date.now() + ((new Date().getTimezoneOffset() + (540)) * 60 * 1000));
            if (isNaN(date.getTime())) return;
            date.setHours(12);

            // https://qiita.com/akebi_mh/items/b6a9c056d9198552e7b4
            var day = date.getTime() / 864e5 - 6.475,
                r = 29.530588853 + 2.162e-9 * ((date.getTime() - 946727935816) / 315576e5), // 平均朔望月
                age = day > 0 ? day % r : (r + day % r) % r;
            console.log(day, r, age);
            element.innerText += age;

            /*
            新月（しんげつ）：月は太陽といっしょに朝のぼってきて、夕方にしずむ。
            上弦（じょうげん）：月は昼間にのぼってきて、ま夜中にしずむ。
            満月（まんげつ）：月は夕方にのぼってきて、朝にしずむ。
            下弦（かげん）：月はま夜中にのぼってきて、昼間にしずむ。
            */
            var geturei = Math.round(age);
            if (geturei == 29 || geturei == 0) {
                element.innerText += "（新月）";
            } else if (geturei == 7 || geturei == 8) {
                element.innerText += "（上弦）";
            } else if (geturei == 14 || geturei == 15) {
                element.innerText += "（満月）";
            } else if (age == 21 || age == 22) {
                element.innerText += "（下弦）";
            }
        }
        calcGeturei();
    </script>
</body>

</html>